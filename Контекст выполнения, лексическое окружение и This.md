**Контекст выполнения - окружение, в котором производится выполение кода. Код всегда выполняется внутри какого-то контекста.**


## Типы контекстов выполнения

В JavaScript существует три типа контекстов выполнения:

-  Глобальный контекст - обычно `window`, либо `globalThis`(поддерживается Node JS и большинством браузеров). Внутри него описаны все внутренние функции, типы, объекты и т.п. в JavaScript. Он явлляется контекстом по умолчанию. На сайте может быть только один глобальный контекст 

-  Контекст выполнения функции. Он создается каждый раз, когда мы вызываем функцию. (Только при вызове функции. При Function Declaration, или Function Expression контекст не создается) 

-   Контекст  `eval`. Код, выполняемый внутри функции `eval`, также имеет собственный контекст выполнения. (Больше о нем здесь не будет упоминаний)

## Стек вызовов

Стек вызовов в JS организован по принципу LIFO(Last In, First Out). Это означает, что элементы, поступившие в стек позже, будут выполнены раньше.

Контекст выполнения тесно связан со стеком вызовов. 
Когда движок начинает выполнять JS скрипт, он создает глобальный контекст и помещает его в начало стека вызовов. При вызове какой-либо функции, движок создает контекст выполнения этой функции и помещает ее в верхнюю часть стека.
Когда работа функции завершается, управление передается предыдущему элменту стека.

Например:
1) Скрипт начинает выполняться, создается глобалльный контекст и помещается в стек. 
2) По мере выполнения скрипта, вызывается функция - для нее тоже создается контекст и помещается в верхнюю часть стека.
3) Внутри этой функции вызывается еще одна функция. Ее (только что созданный) контекст так же помещается наверх стека.
4) Обе функции выполняются, их контекст поочередно извлекается из стека и управление снова передается глобальному контексту.

## Подробнее о контексте выполнения.
### Создание контекста 
При создании контекста выполняются следующие действия:
1) Определяется значение this и осуществляется его привязка.
2) Создается компонент `Lexical Environment` (Лексическое окружение)
3) Создается компонент `Variable Environment` (Окружение переменных)

### Привязка this
В контексте выполнения функции, значение this зависит от того, как функция была вызвана: 
Если в качестве метода, то this привязывается к объекту, что указан перед точкой. 
Иначе, this = window, или this = undefined (В строгом режиме);
 

## Лексическое окружение
Лексическое окружение - структура, которая хранит сведения о соответствии идентификаторов и значений переменных (Environment Record) и ссылку на внешнее лексическое окружение(при отсутствии такового - null).

Сведения о соответствии идентификаторов и значений - можно представить как объект, в котором имя свойства и его значение(ссылка на это значение, если быть точнее) - это имя и значение переменной(либо функции/объекта и т.д.) соответственно.

#### Запись окружения (Environment Record)
Существует 2 типа записей окружения:
- Декларативная - хранит переменные, функции и параметры.
- Объектная - хранит данные о переменных и функциях в глобальном контексте

---

Ссылки: [[Methods, This]], [[LJS Chapter 4]]